{% extends 'map/base.html' %}
{% load static %}
{% load i18n %}

{% block title %}MAP VIEW{% endblock %}

{% block content %}

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ==" crossorigin=""/>

    <!-- Make sure you put this AFTER Leaflet's CSS -->
    <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js" integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew==" crossorigin=""></script>

    <div id="mapid"></div>

    <script>

        const districts = {{ districts|safe }};
        var mymap = L.map('mapid').setView([-8.8315139, 125.6199236,8], 8);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png?{foo}', {foo: 'bar', attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>'}).addTo(mymap);
        L.geoJSON(districts, {
            style: function (feature) {
                return {color: 'orange'};
            }
        }).bindPopup(function (layer) {
            var name = layer.feature.properties.name;
                return 'Distritu: ' + name[0] + name.substr(1).toLowerCase();
        }).addTo(mymap);
        {%for photo in geoimages %}
            {% if photo.lon and photo.lat %}
        L.marker([{{ photo.lat }}, {{ photo.lon }}]).bindPopup("<img src='{{photo.photo}}' height='90' width='90'>"+"</br>{{ photo.district }} | {{ photo.subdistrict }} | {{ photo.suco }} | {{ photo.aldeia}}"+"</br><a target='_blank' href='https://www.google.com/maps?q={{photo.lat}},{{photo.lon}}'>Detail</a>").openPopup().addTo(mymap);
            {% endif %}
        {%endfor%}

    </script>

    <div class="container">
        <div class="row navbar-journey">
            <div class="col-md-8">
                <h3 class="trip-text">{% trans 'Our histories for our trip' %}</h3>
            </div>
            <!--
            <div class="col-md-6 search-journey">
                <input type="text" name="search" placeholder="Search..">
            </div>
            -->
            <div class="col-md-4">
                <a href={% url 'hatama_viazen' %} class="btn btn-primary add-journey">{% trans 'Add my journey' %}</a>
            </div>
        </div>
        <div class="row">
            <div class="col-md-2 list-users">
                {% for user in users %}
                    <span class="person-name">{{ user.first_name|default:user.username }}</span>
                {% endfor %}
            </div>
            <div class="col-md-10 display-all-post">
                {% for via in viazen %}
                    {% if via.creator %}
                    <div class="each-upload">
                        <div class="dropdown dropdown-edit-and-delete">
                            <span class="dropdown-toggle edit-and-delete-toggle" type="button" data-toggle="dropdown"></span>
                            <ul class="dropdown-menu menu-dropdown">
                                <li class="hover-list"><a href="{% url 'photo_viazen' via.pk %}">{% trans 'Add Photo' %}</a>
                                <li class="hover-list"><a href="{% url 'update_viazen' via.pk %}">{% trans 'Edit' %}</a>
                                   <span class="glyphicon glyphicon-pencil"></span>
                                </li>
                                <li class="hover-list"><a href="{% url 'delete_viazen' via.pk %}">{% trans 'Delete' %}</a>
                                   <span class="glyphicon glyphicon-trash"></span>
                                </li>
                            </ul>
                        </div>
                        <p><img src="{% static 'img/default_profile.jpg' %}" class="rounded-circle" alt="Cinque Terre" width="40" height="40">
                            <strong class="person-name">{{ via.creator }}</strong>
                        </p>
                        <strong>{{ via.title }}</strong>
                        <div class="gallery">
                            {%for photo in geoimages %}
                                {% if photo.viazen_id == via.id %}
                                    <figure>
                                        <img src='{{ photo.photo }}' class="gallery-img" width="300" height="240" alt="Image {{ photo.pk}}">
                                    </figure>
                                {% endif %}
                            {% endfor %}
                        </div>
                        <p>{{ via.description }}</p>
                        <p class="text-muted h6">{{ via.date.lower }} - {{ via.date.upper }}</p>
                    </div>
                    {% endif %}
                {% endfor %}
            </div>
        </div>
    </div>
{% endblock %}
